<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AS Hero!</title>

</head>
<body>
    <style>
        body {
            width: 100vw;
            height: 100vh;
            overflow: auto;
            margin: 0;
            font-family: Ubuntu, sans-serif;
        }

        #mechContainer {
            display: flex;
            flex-direction: column;
            flex-wrap:wrap 
        }

        #mechName {
            width: 40em;
        }
    </style>

    <vpl-label prefix="Mech Name:">
        <input type="text" id="mechName" slot="content"></input>
    </vpl-label>
    <div id="mechContainer"> </div>
    <script type="module" src = "/src/components/pips.js"></script>
    <script type="module" src = "/src/components/label.js"></script>
    <script type="module" src = "/src/unitCard.js"></script>
    <script type="module">
        const handleError = err => {
            console.log(err);
        }
        const mechNameElem = document.getElementById("mechName");
        const mechContainerElem = document.getElementById("mechContainer");
        mechNameElem.addEventListener("keypress", async event => {
            if (event.key ===   "Enter") {
                try {
                const mechName = `${mechNameElem.value}`;
                const unParsed = await window.fetch(`http://masterunitlist.info/Unit/QuickList?MinPV=1&MaxPV=999&Name=${mechName}&_=1517453647342`);
                const data = JSON.parse(await unParsed.text()).Units;
                for (const mech of data) {
                    const card = document.createElement("unit-card");
                    mech.name = mech.Name;
                    mech.pv = mech.BFPointValue;
                    mech.armor = mech.BFArmor;
                    mech.structure = mech.BFStructure;
                    mech.damage = {
                        short: mech.BFDamageShort,
                        medium: mech.BFDamageMedium,
                        long: mech.BFDamageLong,
                    };
                    mech.movement = mech.BFMove;
                    mech.image = mech.ImageUrl;
                    card.data = mech;
                    mechContainerElem.appendChild(card);
                }
            }
            catch (err) {
                handleError(err);
            }  
            }
        });
    </script>
</body>
</html>
